<html>
   <head>
      <title>Drawing</title>
      <style>
         canvas{
            /*background-color:yellow;*/
         }

      </style>
      <script src = 'functions.js'></script>
   </head>
   <body>
      <button id = 'send'> Send! </button>
      <script>
         var unitWidth = 10;
         var grid = createMatrix(10);
         fillMatrix(grid,unitWidth, 1, 1);
         //canvas code
         var canvas = document.createElement('canvas');
         canvas.height = 200;
         canvas.width = 200;
         document.body.appendChild(canvas);
         context = canvas.getContext('2d');
         //

         renderLines(context, grid, unitWidth);
         renderGrid(context, grid, unitWidth);
         dragging = false;

         var drawing_data; //used to send to server
         var button = document.getElementById('send');
         button.addEventListener('click', function(evt){
            var point = calculateOffset(evt.clientX, evt.clientY);
            detectClick(grid, unitWidth, point.x, point.y);
            renderGrid(context, grid, unitWidth);
         })
         //event listeners
         document.addEventListener('mousedown', function(evt){
            dragging = true;
         });
         document.addEventListener('mouseup', function(evt){
            dragging = false;
         });
         document.addEventListener('mousemove', function(evt){
            if(dragging){ //Not very efficient: cpu usage preventing from detecting, repaint on each call?
               context.fillStyle = 'black';
               var point = calculateOffset(evt.clientX, evt.clientY);
               context.beginPath();
               context.arc(point.x, point.y, 2, 0, 2*Math.PI, false);
               context.fill();
            }
         });
         document.addEventListener('keydown', function(evt){
            if (evt.keyCode===32){
               context.clearRect(0,0,canvas.width, canvas.height);
               context.rect(9,9, 30,30);
               context.stroke();
            }
            else if (evt.keyCode === 83){ //keyCode = s
               var rect = returnRect() //imageData object
               context.putImageData(rect, 60, 60);
               var data = rect.data; //
               var answer = '';
               for (var i = 0; i< data.length; i+=4){
                  answer += convertPixels([data[i], data[i+1], data[i+2], data[i+3]])+ ','
               }
               answer= answer.substring(0, answer.length-1); //chop off trailing comma
               drawing_data = answer;
               drawing_data = "toRead="+drawing_data;
            }
         });


      </script>
   </body>
</html>
